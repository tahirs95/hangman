<!DOCTYPE html>
<html lang="en">
<head>
  <title>Game</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
<!-- Bootstrap core CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
<!-- Material Design Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.18.0/css/mdb.min.css" rel="stylesheet">  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/static/assets/css/style.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand mx-auto text-center" href="/"><img id="logo" src="/static/assets/images/logo.png"></a>
        
      </nav>
<div class="container">
          <div class="mt-5 text-center">
          <a href="#" class="btn btn-outline-light font-weight-bold w-100 disabled" data-mdb-ripple-color="dark">
            <h5 class="font-weight-bold"> Manage The Group Members </h5>
          </a>
        </div>
        <div class="mt-3">
          <div class="alert alert-danger text-center"  id="error">Please Select Students</div>
           <form method="POST" action="/add_players/" id="form_post">
             {% csrf_token %}
              {% if teacher_players_list|length > 0 %}
              <div id="form">
             {% for student in teacher_players_list %}
              {% if forloop.first %}
            <div class="form-group row justify-content-center" id="form-{{ forloop.counter0 }}">
                <div class="col-sm-5">
                    <select class="form-control  mt-2" onchange="dropdown_val(this)" name="players" id="select-{{ forloop.counter0 }}">
                         {% for player in player_names %}
                        <option class="a-{{player}}" value="{{player}}">{{player}}</option>
                        {% endfor %}
                      </select>
                </div>
                <div class="col-sm-2">
                </div>
              </div>

                {% else %}
                  <div class="form-group row justify-content-center" id="form-{{ forloop.counter0 }}">
                      <div class="col-sm-5">
                          <select class="form-control  mt-2" onchange="dropdown_val(this)" name="players" id="select-{{ forloop.counter0 }}">
                               {% for player in player_names %}
                              <option class="a-{{player}}" value="{{player}}">{{player}}</option>
                              {% endfor %}
                            </select>
                       
                      </div>
                      <div class="col-sm-2">
                        <button  type="button" class="btn btn-outline-light font-weight-bold waves-effect" style="width: 100% !important;" data-mdb-ripple-color="dark" onclick="delete_student({{ forloop.counter0 }})">
                          Delete </button>
                      </div>
                    </div>

                    {% endif %}
                {% endfor %}
              </div>
                {% else %}
                <div id="form">
                <div class="form-group row justify-content-center" id="form-0">
                  <div class="col-sm-5">
                      <select class="form-control  mt-2" onchange="dropdown_val(this)" name="players" id="select-0">
                           {% for player in player_names %}
                          <option class="a-{{player}}" value="{{player}}">{{player}}</option>
                          {% endfor %}
                        </select>
                  </div>
                  <div class="col-sm-2">
                  </div>
                </div>
              </div>
                {% endif %}

              <div class="col-sm-3 mt-2 mx-auto">
                <button type="button" class="btn btn-outline-light font-weight-bold waves-effect" style="width: 100% !important;" data-mdb-ripple-color="dark" onclick="add_student()">
                    <i class="fa fa-plus"></i> Student </button>
             </div>
             <br>
             <div class="mt-4 text_right">
                <button type="button" class="btn btn-outline-light font-weight-bold waves-effect" data-mdb-ripple-color="dark" onclick="form_value()">
                  <h5 class="font-weight-bold"> Submit </h5>
                </button>
              </div>
           </form>
        </div>
    </div>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.18.0/js/mdb.min.js"></script>
<script>
  var list = {{teacher_players_list|length}}
  var players = {{teacher_players_list|safe}}
  console.log(players)
    var count = 1;
    if(list>0){
      for(var i = 0 ; i<list;i++){
        document.querySelector("#select-"+i).value = players[i]
        document.querySelectorAll(".a-"+players[i]).forEach(function(elem2){
         elem2.disabled = true;
     })
     $("select[id=select"+i+"] :selected").attr("disabled",false) 
      }
      count  = list;
    }
function add_student(){
    $("#form").append( ` <div class="form-group row justify-content-center" id="form-`+count+`">
                <div class="col-sm-5">
                    <select class="form-control  mt-2" onchange="dropdown_val(this)" name="players" id="select-`+count+`">
                        <option value="0">-</option>
                        {% for player in player_names %}
                        <option class="a-{{player}}" value="{{player}}">{{player}}</option>
                        {% endfor %}
                    </select>
                 </div>
                 <div class="col-sm-2">
                     <button  type="button" class="btn btn-outline-light font-weight-bold waves-effect" style="width: 100% !important;" data-mdb-ripple-color="dark" onclick="delete_student(`+count+`)">
                     Delete </button>
                 </div>
              </div>` )
            
              
}

function delete_student(item){
  var value = document.getElementById("select-"+item).value
  document.querySelectorAll(".a-"+value).forEach(function(elem2){
      elem2.disabled = false;
  }) 
$("#form-"+item).remove();
}

function dropdown_val(elem){
    $('option[disabled').removeAttr("disabled")
  document.querySelectorAll(".a-"+elem.value).forEach(function(elem2){
      elem2.disabled = true;
  })
  $("select[id="+elem.id+"] :selected").attr("disabled",false) 
}

function form_value(){
  var count = 0;
  document.querySelectorAll(".form-control").forEach(function(elem){
    if(elem.value == "0"){
     document.getElementById("error").style.display = "block";
      return;
    }
    else{
      count++;
    }
  })
  if(count == document.querySelectorAll(".form-control").length ){
    document.getElementById("error").style.display = "none";
    document.getElementById("form_post").submit();

  }
}
</script>    
</body>